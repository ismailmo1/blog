<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-11-20">
<meta name="description" content="Exploring a strange statistic about the Liverpool starting 11 in the Champions League final">

<title>Ismail Mohammed - The Mystery of 2019 Champions League Final</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6GL9ZFETVN"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-6GL9ZFETVN', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Ismail Mohammed - The Mystery of 2019 Champions League Final">
<meta property="og:description" content="Exploring a strange statistic about the Liverpool starting 11 in the Champions League final">
<meta property="og:image" content="https://github.com/ismailmo1/blog/posts/CL19-strangers/lineup.jpg">
<meta property="og:site-name" content="Ismail Mohammed">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ismail Mohammed</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ismailmo1"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/ismailmo-chem"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Mystery of 2019 Champions League Final</h1>
                  <div>
        <div class="description">
          Exploring a strange statistic about the Liverpool starting 11 in the Champions League final
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">web-scraping</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">pandas</div>
                <div class="quarto-category">matplotlib</div>
                <div class="quarto-category">data-viz</div>
                <div class="quarto-category">football</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 20, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link active" data-scroll-target="#data-collection"><span class="toc-section-number">1</span>  Data Collection</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing"><span class="toc-section-number">2</span>  Data Processing</a></li>
  <li><a href="#initial-visualisation" id="toc-initial-visualisation" class="nav-link" data-scroll-target="#initial-visualisation"><span class="toc-section-number">3</span>  Initial Visualisation</a></li>
  <li><a href="#more-data-processing" id="toc-more-data-processing" class="nav-link" data-scroll-target="#more-data-processing"><span class="toc-section-number">4</span>  More Data Processing</a></li>
  <li><a href="#final-visualisation" id="toc-final-visualisation" class="nav-link" data-scroll-target="#final-visualisation"><span class="toc-section-number">5</span>  Final Visualisation</a></li>
  <li><a href="#feedback" id="toc-feedback" class="nav-link" data-scroll-target="#feedback"><span class="toc-section-number">6</span>  Feedback</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/quarto-dev/quarto-demo/blob/main/posts/CL19-strangers/avail-heatmaps.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/quarto-dev/quarto-demo/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<p><em>This blog was inspired by <a href="https://old.reddit.com/r/LiverpoolFC/comments/yxmvu8/the_liverpool_team_that_started_the_uefa/">this reddit post.</a></em></p>
<p>You can skip to the final visualisation <a href="#final-visualisation">here</a>.</p>
<p>On the night of June 1st in 2019, Liverpool would go on to win their 6th Champions League, their first since the dramatic final in 2005 and also the first major trophy won under Jurgen Klopp who joined the club in 2015. That night was significant for many reasons but a strange statistic caught my attention:</p>
<blockquote class="blockquote">
<p>The 11 players that started in the Champions league final had never started a game together before, and has never started again since.</p>
</blockquote>
<p>The rest of this article will explore the data around this statistic and uncover why this team has only ever started together once.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lineup.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Starting 11 for the final</figcaption><p></p>
</figure>
</div>
<p>This starting lineup is remembered by many fans as <em>the</em> defining team of that era and many of the comments from the reddit post capture why the statistic above is so unintuitive.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="reddit-comments.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Comments on the stat from reddit</figcaption><p></p>
</figure>
</div>
<p>So how can this be possible? To try and uncover the mystery we can start by looking at the data from the games played during that season and extract the starting 11 from each game.</p>
<section id="data-collection" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Data Collection</h1>
<p>There are many free resources for football data, but <a href="transfermarket">transfermarket</a> seemed to be the best option to minimise the post-processing needed for this analysis. The code used to scrape this data can be found <a href="https://github.com/ismailmo1/football-data-viz/tree/main/transfermarket">here</a> - the key libraries used were <a href="https://pandas.pydata.org/">pandas</a>, <a href="https://beautiful-soup-4.readthedocs.io/en/latest/">beautifulsoup</a> and <a href="https://requests.readthedocs.io/en/latest/">requests</a>.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Data collection and processing libraries</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># filter pandas warnings before importing</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> warnings</span>
<span id="cb1-5"><a href="#cb1-5"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># haven't published library to pypi yet so add local folder to path</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># see https://github.com/ismailmo1/football-data-viz/tree/main/transfermarket</span></span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>module_path <span class="op">=</span> <span class="st">'/home/ismail/projects/football-data-viz/transfermarket/'</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="cf">if</span> module_path <span class="kw">not</span> <span class="kw">in</span> sys.path:</span>
<span id="cb1-14"><a href="#cb1-14"></a>    sys.path.append(module_path)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="im">from</span> transfermarket <span class="im">import</span> leagues, players, teams</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>prem_clubs_18 <span class="op">=</span> leagues.get_prem_club_list(season<span class="op">=</span><span class="st">"2018"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>lpool_19_players <span class="op">=</span> teams.get_players(team_url<span class="op">=</span>prem_clubs_18[<span class="st">'Liverpool FC'</span>])</span>
<span id="cb2-3"><a href="#cb2-3"></a>lpool_19_players.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>dict_keys(['Virgil van Dijk', 'Adam Lallana', 'Sheyi Ojo', 'Andrew Robertson', 'Alisson', 'Georginio Wijnaldum', 'Roberto Firmino', 'Dominic Solanke', 'Rhian Brewster', 'Ádám Bogdán', 'Loris Karius', 'Harry Wilson', 'Alex Oxlade-Chamberlain', 'Kamil Grabara', 'Jordan Henderson', 'Daniel Sturridge', 'Divock Origi', 'Nathaniel Clyne', 'Ben Woodburn', 'Danny Ings', 'Sadio Mané', 'Joel Matip', 'Isaac Christie-Davies', 'James Milner', 'Caoimhín Kelleher', 'Joe Gomez', 'Simon Mignolet', 'Fabinho', 'Marko Grujić', 'Ki-Jana Hoever', 'Trent Alexander-Arnold', 'Rafael Camacho', 'Xherdan Shaqiri', 'Dejan Lovren', 'Curtis Jones', 'Alberto Moreno', 'Connor Randall', 'Naby Keïta', 'Mohamed Salah'])</code></pre>
</div>
</div>
<p>We’re only interested in the starting 11 from the final so the we can filter out the other players from the squad:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>cl_19_lineup <span class="op">=</span> [<span class="st">'Trent Alexander-Arnold'</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a>                <span class="st">'Georginio Wijnaldum'</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                <span class="st">'Fabinho'</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>                <span class="st">'Jordan Henderson'</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>                <span class="st">'Roberto Firmino'</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>                <span class="st">'Mohamed Salah'</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>                <span class="st">'Joel Matip'</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>                <span class="st">'Virgil van Dijk'</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a>                <span class="st">'Sadio Mané'</span>,</span>
<span id="cb4-10"><a href="#cb4-10"></a>                <span class="st">'Andrew Robertson'</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>                <span class="st">'Alisson'</span>]</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>cl_19_lineup_urls <span class="op">=</span> {player:<span class="st">"https://www.transfermarkt.com"</span> <span class="op">+</span> url <span class="cf">for</span> player,</span>
<span id="cb4-14"><a href="#cb4-14"></a>                        url <span class="kw">in</span> lpool_19_players.items() <span class="cf">if</span> player <span class="kw">in</span> cl_19_lineup}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For each of these players we can grab their availability for each game.</p>
<p><code>get_player_availability</code> scrapes the statistics page for each player and determines which availability category a player falls into for that game.</p>
<p>The categories are:</p>
<ol type="1">
<li>Injured</li>
<li>Not in squad</li>
<li>Bench</li>
<li>Played (sub)</li>
<li>Played (starter)</li>
</ol>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>avail_18_19 <span class="op">=</span> []</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb5-4"><a href="#cb5-4"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2018"</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>    avail_18_19.append(avail_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-processing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data Processing</h1>
<p>Most of the data processing is done in a separate module (see code <a href="https://github.com/ismailmo1/football-data-viz/tree/main/transfermarket">here</a>) but for this specific analysis we want to ensure we are only looking at data related to Liverpool fixtures, since the player availability data will also include international games for their country.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>strangers<span class="op">=</span> pd.concat(avail_18_19)</span>
<span id="cb6-2"><a href="#cb6-2"></a>liverpool_fix <span class="op">=</span> teams.get_team_fixtures(prem_clubs_18[<span class="st">"Liverpool FC"</span>], <span class="st">"2018"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>fixtures_num_starters <span class="op">=</span> strangers.T.join(liverpool_fix, how<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>heatmap_data <span class="op">=</span> fixtures_num_starters.iloc[:, :<span class="dv">11</span>].T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are also cases where the availability doesn’t fall into any of the categories above, so in that case we assume that they weren’t in the squad. This usually occurs when the player is suspended since the web-scraping logic doesn’t account for that (yet) - but there could also be other cases where transfermarket’s description doesn’t meet any of the logic defined in the web-scraping functions. We’ll see some more examples later where there are rooms for improvement in the web-scraper and the visualisations help identify these.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># assumption: NaN value means they were likely suspended</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># either way they werent in the squad so makes sense </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># to assign that (to me atleast!) </span></span>
<span id="cb7-4"><a href="#cb7-4"></a>fixtures_num_starters.fillna(<span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a>fixtures_num_starters <span class="op">=</span> fixtures_num_starters.iloc[:,:<span class="dv">11</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of players in the starting lineup can be calculated from the availability category they were put into: we can take a sum of all the instances of “Played (starter)” for each game.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># add count</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>fixtures_num_starters[<span class="st">'strangers_count'</span>] <span class="op">=</span> (fixtures_num_starters <span class="op">==</span> <span class="dv">4</span> ).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>fixtures_num_starters.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is what our processed data looks like (showing first 5 rows only)</p>
<div class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>virgil-van-dijk</th>
      <th>andrew-robertson</th>
      <th>alisson</th>
      <th>georginio-wijnaldum</th>
      <th>roberto-firmino</th>
      <th>jordan-henderson</th>
      <th>sadio-mane</th>
      <th>joel-matip</th>
      <th>fabinho</th>
      <th>trent-alexander-arnold</th>
      <th>mohamed-salah</th>
      <th>strangers_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="initial-visualisation" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Initial Visualisation</h1>
<p>Now for the fun part! Since our data is 2 dimensional : players and dates, a heatmap seems like it would be a good way to to visualise the availability of each individual player over the course of the season, and a bar plot to keep count of how many of them started the game:</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Visualisation libraries</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-4"><a href="#cb9-4"></a>matplotlib.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'JetBrains Mono'</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>matplotlib.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="st">'20'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>While this plot still needs a lot of work and cleanup - it’s a nice way to visualise the data - we can see that the final column in the heatmap is the only time when all boxes are green: of course this is the night of that champions league final.</p>
<p>There are quite a few things to fix in the visualisation here:</p>
<ul>
<li>Add titles and labels to axes</li>
<li>Change y tick labels in player count bar plot to include max (11)</li>
<li>Replace color bar with text instead of numbers to map availability level categories</li>
<li>Improve color scheme to make it more accessible</li>
<li>Align the bars in the bar plot so it is aligned with the heatmap squares - currently it is offset</li>
</ul>
<div class="cell page-columns page-full" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">10</span>), nrows<span class="op">=</span><span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, height_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">4</span>], constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>bar_plot <span class="op">=</span> ax1.bar(fixtures_num_starters.index, fixtures_num_starters[<span class="st">"strangers_count"</span>])</span>
<span id="cb10-4"><a href="#cb10-4"></a>plot <span class="op">=</span> sns.heatmap(fixtures_num_starters.iloc[:, :<span class="op">-</span><span class="dv">1</span>].T, ax<span class="op">=</span>ax2, cmap<span class="op">=</span>sns.color_palette(<span class="st">"RdYlGn"</span>),linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">'lightgray'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-screen">
<p><img src="avail-heatmaps_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Before we address the visualisation adjustments, lets grab some data for the previous season (2017/2018) so we can add some more context around the statistic:</p>
</section>
<section id="more-data-processing" class="level1 page-columns page-full" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> More Data Processing</h1>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>liverpool_fix_17_18 <span class="op">=</span> teams.get_team_fixtures(prem_clubs_18[<span class="st">"Liverpool FC"</span>], <span class="st">"2017"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>avail_17_18 <span class="op">=</span> []</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb12-4"><a href="#cb12-4"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2017"</span>, add_match_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="co"># add liverpool fixture data</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>    avail_df <span class="op">=</span> avail_df.T.join(liverpool_fix_17_18, how<span class="op">=</span><span class="st">"right"</span>, rsuffix<span class="op">=</span><span class="st">"_lpool"</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a>    avail_17_18.append(avail_df.T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>More data, more problems - we now need to account for when players didn’t play for Liverpool - e.g.&nbsp;Virgil Van Dijk only join in January 2018 and was playing for Southampton during the first half of the season:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>vvd_idx <span class="op">=</span> [idx <span class="cf">for</span> idx, df <span class="kw">in</span> <span class="bu">enumerate</span>(avail_17_18) <span class="cf">if</span> <span class="st">'virgil'</span> <span class="kw">in</span> df.index[<span class="dv">0</span>]][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>avail_17_18[vvd_idx].iloc[:<span class="dv">5</span>, :<span class="dv">5</span>].dropna(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>Date</th>
      <th>2017-08-12</th>
      <th>2017-08-19</th>
      <th>2017-08-23</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>virgil-van-dijk</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Home team.1</th>
      <td>Southampton (11.)</td>
      <td>Southampton (11.)</td>
      <td>Southampton</td>
    </tr>
    <tr>
      <th>Away team.1</th>
      <td>Swansea (12.)</td>
      <td>West Ham (20.)</td>
      <td>Wolves</td>
    </tr>
    <tr>
      <th>Result</th>
      <td>0:0</td>
      <td>3:2</td>
      <td>0:2</td>
    </tr>
    <tr>
      <th>Matchday</th>
      <td>1</td>
      <td>2</td>
      <td>Qualifying Round 2nd leg</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can account for this by adding another category to our availability levels:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">def</span> is_liverpool(rw):</span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="cf">try</span>:</span>
<span id="cb15-3"><a href="#cb15-3"></a>        <span class="cf">if</span> <span class="st">'Liverpool'</span> <span class="kw">in</span> rw[<span class="st">'Home team.1'</span>] <span class="kw">or</span> <span class="st">'Liverpool'</span> <span class="kw">in</span> rw[<span class="st">'Away team.1'</span>]:</span>
<span id="cb15-4"><a href="#cb15-4"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>        <span class="cf">else</span>:</span>
<span id="cb15-6"><a href="#cb15-6"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="cf">except</span> <span class="pp">TypeError</span>:</span>
<span id="cb15-8"><a href="#cb15-8"></a>        <span class="cf">return</span> <span class="va">False</span> </span>
<span id="cb15-9"><a href="#cb15-9"></a>vvd <span class="op">=</span> avail_17_18[vvd_idx].T</span>
<span id="cb15-10"><a href="#cb15-10"></a>vvd[<span class="st">'is_lpool'</span>] <span class="op">=</span> vvd.<span class="bu">apply</span>(is_liverpool, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="kw">def</span> add_diff_team_availability(rw):</span>
<span id="cb15-13"><a href="#cb15-13"></a>    <span class="co">"""add -1 if player isn't playing a liverpool game"""</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>    <span class="cf">if</span> rw[<span class="st">'is_lpool'</span>] <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb15-15"><a href="#cb15-15"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="cf">else</span>:</span>
<span id="cb15-17"><a href="#cb15-17"></a>        <span class="co"># availability col</span></span>
<span id="cb15-18"><a href="#cb15-18"></a>        <span class="cf">return</span> rw[<span class="dv">0</span>]</span>
<span id="cb15-19"><a href="#cb15-19"></a></span>
<span id="cb15-20"><a href="#cb15-20"></a>vvd.iloc[:,<span class="dv">0</span>] <span class="op">=</span> vvd.<span class="bu">apply</span>(add_diff_team_availability, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This heuristic doesn’t work when they play against Liverpool for their old club - but we can just fix that manually since it’ll be easy to spot (one game for Liverpool surrounded by loads of games for Southampton will stick out like a sore thumb)</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>vvd.sample(<span class="dv">5</span>).iloc[:, :<span class="dv">3</span>].dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>virgil-van-dijk</th>
      <th>Home team.1</th>
      <th>Away team.1</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-06</th>
      <td>4</td>
      <td>Chelsea (5.)</td>
      <td>Liverpool (4.)</td>
    </tr>
    <tr>
      <th>2018-02-11</th>
      <td>4</td>
      <td>Southampton (15.)</td>
      <td>Liverpool (3.)</td>
    </tr>
    <tr>
      <th>2018-04-21</th>
      <td>4</td>
      <td>West Brom (20.)</td>
      <td>Liverpool (3.)</td>
    </tr>
    <tr>
      <th>2017-11-29</th>
      <td>-1</td>
      <td>Man City (1.)</td>
      <td>Southampton (10.)</td>
    </tr>
    <tr>
      <th>2018-02-04</th>
      <td>4</td>
      <td>Liverpool (3.)</td>
      <td>Spurs (5.)</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<details>
<summary>Let’s now grab data for the seasons before and after (17/18 and 19/20, 20/21 and 21/22)</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># should have refactored the data collection/processing loop into a function</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>avail_17_18 <span class="op">=</span> []</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb17-5"><a href="#cb17-5"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2017"</span>, add_match_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="co"># add liverpool fixture data</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>    transposed_df <span class="op">=</span> avail_df.T</span>
<span id="cb17-8"><a href="#cb17-8"></a>    transposed_df<span class="op">=</span> transposed_df.join(liverpool_fix_17_18, how<span class="op">=</span><span class="st">"right"</span>, rsuffix<span class="op">=</span><span class="st">"_lpool"</span>)</span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a>    transposed_df[<span class="st">'is_lpool'</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(is_liverpool, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>    transposed_df.iloc[:,<span class="dv">0</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(add_diff_team_availability, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-12"><a href="#cb17-12"></a>    transposed_df <span class="op">=</span> pd.DataFrame(transposed_df.iloc[:,<span class="dv">0</span>]).T</span>
<span id="cb17-13"><a href="#cb17-13"></a>    avail_17_18.append(transposed_df)</span>
<span id="cb17-14"><a href="#cb17-14"></a>    </span>
<span id="cb17-15"><a href="#cb17-15"></a>avail_17_18_all <span class="op">=</span> pd.concat(avail_17_18)</span>
<span id="cb17-16"><a href="#cb17-16"></a>avail_17_18_all.fillna(<span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-17"><a href="#cb17-17"></a></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="co"># add count</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>long_avail_17_18_df <span class="op">=</span> avail_17_18_all.T</span>
<span id="cb17-20"><a href="#cb17-20"></a>long_avail_17_18_df[<span class="st">'strangers_count'</span>] <span class="op">=</span> (long_avail_17_18_df <span class="op">==</span> <span class="dv">4</span> ).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-21"><a href="#cb17-21"></a>long_avail_17_18_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co">#| echo: false</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>liverpool_fix_19_20 <span class="op">=</span> teams.get_team_fixtures(prem_clubs_18[<span class="st">"Liverpool FC"</span>], <span class="st">"2019"</span>)</span>
<span id="cb17-24"><a href="#cb17-24"></a>avail_19_20 <span class="op">=</span> []</span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb17-26"><a href="#cb17-26"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2019"</span>, add_match_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="co"># add liverpool fixture data</span></span>
<span id="cb17-28"><a href="#cb17-28"></a>    transposed_df <span class="op">=</span> avail_df.T</span>
<span id="cb17-29"><a href="#cb17-29"></a>    transposed_df<span class="op">=</span> transposed_df.join(liverpool_fix_19_20, how<span class="op">=</span><span class="st">"right"</span>, rsuffix<span class="op">=</span><span class="st">"_lpool"</span>)</span>
<span id="cb17-30"><a href="#cb17-30"></a></span>
<span id="cb17-31"><a href="#cb17-31"></a>    transposed_df[<span class="st">'is_lpool'</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(is_liverpool, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-32"><a href="#cb17-32"></a>    transposed_df.iloc[:,<span class="dv">0</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(add_diff_team_availability, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-33"><a href="#cb17-33"></a>    transposed_df <span class="op">=</span> pd.DataFrame(transposed_df.iloc[:,<span class="dv">0</span>]).T</span>
<span id="cb17-34"><a href="#cb17-34"></a>    avail_19_20.append(transposed_df)</span>
<span id="cb17-35"><a href="#cb17-35"></a>    </span>
<span id="cb17-36"><a href="#cb17-36"></a>avail_19_20_all <span class="op">=</span> pd.concat(avail_19_20)</span>
<span id="cb17-37"><a href="#cb17-37"></a>avail_19_20_all.fillna(<span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-38"><a href="#cb17-38"></a></span>
<span id="cb17-39"><a href="#cb17-39"></a><span class="co"># add count</span></span>
<span id="cb17-40"><a href="#cb17-40"></a>long_avail_19_20_df <span class="op">=</span> avail_19_20_all.T</span>
<span id="cb17-41"><a href="#cb17-41"></a>long_avail_19_20_df[<span class="st">'strangers_count'</span>] <span class="op">=</span> (long_avail_19_20_df <span class="op">==</span> <span class="dv">4</span> ).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-42"><a href="#cb17-42"></a>long_avail_19_20_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-43"><a href="#cb17-43"></a></span>
<span id="cb17-44"><a href="#cb17-44"></a><span class="co">#add 2020/2021</span></span>
<span id="cb17-45"><a href="#cb17-45"></a></span>
<span id="cb17-46"><a href="#cb17-46"></a>liverpool_fix_20_21 <span class="op">=</span> teams.get_team_fixtures(prem_clubs_18[<span class="st">"Liverpool FC"</span>], <span class="st">"2020"</span>)</span>
<span id="cb17-47"><a href="#cb17-47"></a>avail_20_21 <span class="op">=</span> []</span>
<span id="cb17-48"><a href="#cb17-48"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb17-49"><a href="#cb17-49"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2020"</span>, add_match_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-50"><a href="#cb17-50"></a>    <span class="co"># add liverpool fixture data</span></span>
<span id="cb17-51"><a href="#cb17-51"></a>    transposed_df <span class="op">=</span> avail_df.T</span>
<span id="cb17-52"><a href="#cb17-52"></a>    transposed_df<span class="op">=</span> transposed_df.join(liverpool_fix_20_21, how<span class="op">=</span><span class="st">"right"</span>, rsuffix<span class="op">=</span><span class="st">"_lpool"</span>)</span>
<span id="cb17-53"><a href="#cb17-53"></a></span>
<span id="cb17-54"><a href="#cb17-54"></a>    transposed_df[<span class="st">'is_lpool'</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(is_liverpool, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-55"><a href="#cb17-55"></a>    transposed_df.iloc[:,<span class="dv">0</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(add_diff_team_availability, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-56"><a href="#cb17-56"></a>    transposed_df <span class="op">=</span> pd.DataFrame(transposed_df.iloc[:,<span class="dv">0</span>]).T</span>
<span id="cb17-57"><a href="#cb17-57"></a>    avail_20_21.append(transposed_df)</span>
<span id="cb17-58"><a href="#cb17-58"></a>    </span>
<span id="cb17-59"><a href="#cb17-59"></a>avail_20_21_all <span class="op">=</span> pd.concat(avail_20_21)</span>
<span id="cb17-60"><a href="#cb17-60"></a>avail_20_21_all.fillna(<span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-61"><a href="#cb17-61"></a></span>
<span id="cb17-62"><a href="#cb17-62"></a><span class="co"># add count</span></span>
<span id="cb17-63"><a href="#cb17-63"></a>long_avail_20_21_df <span class="op">=</span> avail_20_21_all.T</span>
<span id="cb17-64"><a href="#cb17-64"></a>long_avail_20_21_df[<span class="st">'strangers_count'</span>] <span class="op">=</span> (long_avail_20_21_df <span class="op">==</span> <span class="dv">4</span> ).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-65"><a href="#cb17-65"></a>long_avail_20_21_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-66"><a href="#cb17-66"></a><span class="co">#add 2021/2022</span></span>
<span id="cb17-67"><a href="#cb17-67"></a></span>
<span id="cb17-68"><a href="#cb17-68"></a>liverpool_fix_21_22 <span class="op">=</span> teams.get_team_fixtures(prem_clubs_18[<span class="st">"Liverpool FC"</span>], <span class="st">"2021"</span>)</span>
<span id="cb17-69"><a href="#cb17-69"></a>avail_21_22 <span class="op">=</span> []</span>
<span id="cb17-70"><a href="#cb17-70"></a><span class="cf">for</span> player,url <span class="kw">in</span> cl_19_lineup_urls.items():</span>
<span id="cb17-71"><a href="#cb17-71"></a>    avail_df <span class="op">=</span> players.get_player_availability(url,<span class="st">"2021"</span>, add_match_result<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-72"><a href="#cb17-72"></a>    <span class="co"># add liverpool fixture data</span></span>
<span id="cb17-73"><a href="#cb17-73"></a>    transposed_df <span class="op">=</span> avail_df.T</span>
<span id="cb17-74"><a href="#cb17-74"></a>    transposed_df<span class="op">=</span> transposed_df.join(liverpool_fix_21_22, how<span class="op">=</span><span class="st">"right"</span>, rsuffix<span class="op">=</span><span class="st">"_lpool"</span>)</span>
<span id="cb17-75"><a href="#cb17-75"></a></span>
<span id="cb17-76"><a href="#cb17-76"></a>    transposed_df[<span class="st">'is_lpool'</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(is_liverpool, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-77"><a href="#cb17-77"></a>    transposed_df.iloc[:,<span class="dv">0</span>] <span class="op">=</span> transposed_df.<span class="bu">apply</span>(add_diff_team_availability, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-78"><a href="#cb17-78"></a>    transposed_df <span class="op">=</span> pd.DataFrame(transposed_df.iloc[:,<span class="dv">0</span>]).T</span>
<span id="cb17-79"><a href="#cb17-79"></a>    avail_21_22.append(transposed_df)</span>
<span id="cb17-80"><a href="#cb17-80"></a>    </span>
<span id="cb17-81"><a href="#cb17-81"></a>avail_21_22_all <span class="op">=</span> pd.concat(avail_21_22)</span>
<span id="cb17-82"><a href="#cb17-82"></a>avail_21_22_all.fillna(<span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-83"><a href="#cb17-83"></a></span>
<span id="cb17-84"><a href="#cb17-84"></a><span class="co"># add count</span></span>
<span id="cb17-85"><a href="#cb17-85"></a>long_avail_21_22_df <span class="op">=</span> avail_21_22_all.T</span>
<span id="cb17-86"><a href="#cb17-86"></a>long_avail_21_22_df[<span class="st">'strangers_count'</span>] <span class="op">=</span> (long_avail_21_22_df <span class="op">==</span> <span class="dv">4</span> ).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-87"><a href="#cb17-87"></a>long_avail_21_22_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-88"><a href="#cb17-88"></a></span>
<span id="cb17-89"><a href="#cb17-89"></a><span class="co"># concatenate all our data </span></span>
<span id="cb17-90"><a href="#cb17-90"></a>all_fix_dates <span class="op">=</span> [<span class="op">*</span>avail_17_18_all.columns, <span class="op">*</span>liverpool_fix.index,<span class="op">*</span>avail_19_20_all.columns, <span class="op">*</span>avail_20_21_all.columns,<span class="op">*</span>avail_21_22_all.columns]</span>
<span id="cb17-91"><a href="#cb17-91"></a>all_avail <span class="op">=</span> pd.concat([long_avail_17_18_df, fixtures_num_starters, long_avail_19_20_df, long_avail_20_21_df,long_avail_21_22_df])</span>
<span id="cb17-92"><a href="#cb17-92"></a></span>
<span id="cb17-93"><a href="#cb17-93"></a><span class="co"># reset index so we dont have to deal with dodgy dates in axes</span></span>
<span id="cb17-94"><a href="#cb17-94"></a>all_avail.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-95"><a href="#cb17-95"></a>all_avail[<span class="st">'date'</span>] <span class="op">=</span> all_fix_dates</span>
<span id="cb17-96"><a href="#cb17-96"></a>all_avail.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>virgil-van-dijk</th>
      <th>andrew-robertson</th>
      <th>alisson</th>
      <th>georginio-wijnaldum</th>
      <th>roberto-firmino</th>
      <th>jordan-henderson</th>
      <th>sadio-mane</th>
      <th>joel-matip</th>
      <th>fabinho</th>
      <th>trent-alexander-arnold</th>
      <th>mohamed-salah</th>
      <th>strangers_count</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>282</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>6</td>
      <td>2022-05-10</td>
    </tr>
    <tr>
      <th>283</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>7</td>
      <td>2022-05-14</td>
    </tr>
    <tr>
      <th>284</th>
      <td>0.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>2022-05-17</td>
    </tr>
    <tr>
      <th>285</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>6</td>
      <td>2022-05-22</td>
    </tr>
    <tr>
      <th>286</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>-1.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>8</td>
      <td>2022-05-28</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>To address some of the ugliness from the <a href="#initial-visualisation">initial visualisation</a> we can make some changes in the visualisation setup (expand code and see comments):</p>
<div class="cell page-columns page-full" data-execution_count="18">
<details>
<summary>Visualisation setup</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>availability_levels_map <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2"></a>                        <span class="st">'Not at Liverpool'</span> : <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb18-3"><a href="#cb18-3"></a>                        <span class="st">'Injured'</span>:<span class="dv">0</span>, </span>
<span id="cb18-4"><a href="#cb18-4"></a>                        <span class="st">'Not in squad'</span>:<span class="dv">1</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>                        <span class="st">'Bench'</span>:<span class="dv">2</span>, </span>
<span id="cb18-6"><a href="#cb18-6"></a>                        <span class="st">'Played (sub)'</span>:<span class="dv">3</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>                        <span class="st">'Played (starter)'</span>:<span class="dv">4</span> </span>
<span id="cb18-8"><a href="#cb18-8"></a>                        }</span>
<span id="cb18-9"><a href="#cb18-9"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">10</span>), nrows<span class="op">=</span><span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, height_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">4</span>], constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co"># align bars to edge so its aligned with the heatmap</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>bar_plot <span class="op">=</span> ax1.bar(all_avail.index, all_avail[<span class="st">"strangers_count"</span>], align<span class="op">=</span><span class="st">"edge"</span>)</span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#  remove x axis label (since we share with heatmap)</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>_ <span class="op">=</span> ax1.set_xlabel(<span class="st">""</span>)</span>
<span id="cb18-15"><a href="#cb18-15"></a>_ <span class="op">=</span> ax1.tick_params(length<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co"># add bar graph y label and only add tick label to max #players</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>_ <span class="op">=</span> ax1.set_ylabel(<span class="st">"#players starting"</span>,rotation<span class="op">=</span><span class="st">"horizontal"</span>, ha<span class="op">=</span><span class="st">"right"</span> )</span>
<span id="cb18-18"><a href="#cb18-18"></a>_ <span class="op">=</span> ax1.yaxis.set_major_locator(matplotlib.ticker.FixedLocator([<span class="dv">11</span>]))</span>
<span id="cb18-19"><a href="#cb18-19"></a>_ <span class="op">=</span> ax1.set_title(<span class="st">"When stars align: The Mythical 2019 CL Final Starting 11"</span>)</span>
<span id="cb18-20"><a href="#cb18-20"></a></span>
<span id="cb18-21"><a href="#cb18-21"></a>num_levels <span class="op">=</span> <span class="bu">len</span>(availability_levels_map.keys())</span>
<span id="cb18-22"><a href="#cb18-22"></a>plot <span class="op">=</span> sns.heatmap(all_avail.iloc[:, :<span class="op">-</span><span class="dv">2</span>].T, ax<span class="op">=</span>ax2, cmap<span class="op">=</span>sns.color_palette(<span class="st">"RdYlGn"</span>,num_levels),linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">'lightgray'</span>)</span>
<span id="cb18-23"><a href="#cb18-23"></a></span>
<span id="cb18-24"><a href="#cb18-24"></a><span class="co"># map colorbar labels with availability levels</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>colorbar <span class="op">=</span> plot.collections[<span class="dv">0</span>].colorbar</span>
<span id="cb18-26"><a href="#cb18-26"></a>total_bar_height <span class="op">=</span> colorbar.vmax <span class="op">-</span> colorbar.vmin </span>
<span id="cb18-27"><a href="#cb18-27"></a>lvl_bar_height <span class="op">=</span> total_bar_height<span class="op">/</span>num_levels</span>
<span id="cb18-28"><a href="#cb18-28"></a></span>
<span id="cb18-29"><a href="#cb18-29"></a>colorbar.set_ticks([colorbar.vmin <span class="op">+</span> (lvl_bar_height <span class="op">*</span> (<span class="fl">0.5</span> <span class="op">+</span> i)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_levels)])</span>
<span id="cb18-30"><a href="#cb18-30"></a>colorbar.set_ticklabels([<span class="op">*</span>availability_levels_map.keys()])</span>
<span id="cb18-31"><a href="#cb18-31"></a></span>
<span id="cb18-32"><a href="#cb18-32"></a><span class="co"># gotta love dates - format them so they look cleaner</span></span>
<span id="cb18-33"><a href="#cb18-33"></a>axs_fmtd <span class="op">=</span> [all_avail.loc[<span class="bu">int</span>(i.get_text()), <span class="st">'date'</span>].strftime(<span class="st">"</span><span class="sc">%d</span><span class="st"> %b"</span>) <span class="cf">for</span> i <span class="kw">in</span> ax2.get_xticklabels()]</span>
<span id="cb18-34"><a href="#cb18-34"></a>_ <span class="op">=</span> ax2.set_xticklabels(axs_fmtd, rotation<span class="op">=</span><span class="st">"vertical"</span>)</span>
<span id="cb18-35"><a href="#cb18-35"></a>_ <span class="op">=</span> ax2.set_xlabel(<span class="st">""</span>)</span>
<span id="cb18-36"><a href="#cb18-36"></a>_ <span class="op">=</span> ax2.tick_params(length<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-37"><a href="#cb18-37"></a>_ <span class="op">=</span> plt.gcf().text(<span class="fl">0.9</span>, <span class="dv">0</span>, <span class="st">"ismailmo.com"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontdict<span class="op">=</span>{<span class="st">'color'</span>:  <span class="st">'blue'</span>} )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display column-screen">
<p><img src="avail-heatmaps_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There are some anomalies where players are marked as “Not at liverpool” even though they definitely were (see Trent, Mane and salah’s red lines)</p>
<p>Mane and Salah were playing eachother at the AFCON final - so technically the graph is correct :)</p>
<div class="cell" data-execution_count="19">
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sadio-mane</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>258</th>
      <td>-1.0</td>
      <td>2022-02-06</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sadio-mane</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>258</th>
      <td>-1.0</td>
      <td>2022-02-06</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>For Trent, the England U21 team were playing at the same time (which Trent used to play for) so our <a href="#more-data-processing">logic</a> that adjusted for games played for other clubs (e.g.&nbsp;Van Dijk for Southampton) picked up this game- since this is a rare edge case I’ll just overwrite it manually</p>
<div class="cell" data-execution_count="21">
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>Date</th>
      <th>2018-05-26</th>
      <th>2018-05-26</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>trent-alexander-arnold</th>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Home team.1</th>
      <td>Real Madrid</td>
      <td>England U21</td>
    </tr>
    <tr>
      <th>Away team.1</th>
      <td>Liverpool</td>
      <td>China U20</td>
    </tr>
    <tr>
      <th>Result</th>
      <td>3:1</td>
      <td>2:1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<details>
<summary>Manually adjusting outlier for Trent</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>trent_outlier <span class="op">=</span> all_avail[<span class="st">'date'</span>]<span class="op">==</span>datetime.datetime(<span class="dv">2018</span>,<span class="dv">5</span>,<span class="dv">26</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a>all_avail.loc[trent_outlier,<span class="st">"trent-alexander-arnold"</span>] <span class="op">=</span> <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The visualisation above shows that the full squad were only playing for Liverpool FC during 2018/19 - 2021-22 (see the blocks of red at the start and end of the heatmap) - we can remove the other seasons (we’ll keep a few rows to highlight their departure/arrival at Liverpool).</p>
<p>Another key change is choosing a better colours palette - <a href="https://colorbrewer2.org/">ColorBrewer</a> is a great resource for finding accessible color schemes based on the research of <a href="http://www.personal.psu.edu/cab38/">Dr Cynthia Brewer</a></p>
<div class="cell" data-execution_count="23">
<details>
<summary>Narrowing down the date range</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>cl_19_lineup_at_lpool_avail_df <span class="op">=</span> all_avail[(all_avail.loc[:,<span class="st">'date'</span>]<span class="op">&gt;</span>datetime.datetime(<span class="dv">2018</span>,<span class="dv">5</span>,<span class="dv">10</span>)) <span class="op">&amp;</span>( all_avail.loc[:,<span class="st">'date'</span>]<span class="op">&lt;</span>datetime.datetime(<span class="dv">2021</span>,<span class="dv">8</span>,<span class="dv">30</span>))]</span>
<span id="cb20-2"><a href="#cb20-2"></a>cl_19_lineup_at_lpool_avail_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="25">
<details>
<summary>Final visualisation setup</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># order players by position</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>heatmap_data <span class="op">=</span> cl_19_lineup_at_lpool_avail_df.loc[:, [<span class="st">'mohamed-salah'</span>,</span>
<span id="cb21-3"><a href="#cb21-3"></a>                                                      <span class="st">'roberto-firmino'</span>,</span>
<span id="cb21-4"><a href="#cb21-4"></a>                                                      <span class="st">'sadio-mane'</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>                                                      <span class="st">'jordan-henderson'</span>,</span>
<span id="cb21-6"><a href="#cb21-6"></a>                                                      <span class="st">'fabinho'</span>,</span>
<span id="cb21-7"><a href="#cb21-7"></a>                                                      <span class="st">'georginio-wijnaldum'</span>,</span>
<span id="cb21-8"><a href="#cb21-8"></a>                                                      <span class="st">'andrew-robertson'</span>,</span>
<span id="cb21-9"><a href="#cb21-9"></a>                                                      <span class="st">'virgil-van-dijk'</span>,</span>
<span id="cb21-10"><a href="#cb21-10"></a>                                                      <span class="st">'joel-matip'</span>,</span>
<span id="cb21-11"><a href="#cb21-11"></a>                                                      <span class="st">'trent-alexander-arnold'</span>,</span>
<span id="cb21-12"><a href="#cb21-12"></a>                                                      <span class="st">'alisson'</span>]].T</span>
<span id="cb21-13"><a href="#cb21-13"></a></span>
<span id="cb21-14"><a href="#cb21-14"></a>matplotlib.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="st">'20'</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>plt.rcParams[<span class="st">"axes.titlesize"</span>] <span class="op">=</span><span class="st">"10"</span> </span>
<span id="cb21-16"><a href="#cb21-16"></a>color_scheme <span class="op">=</span> [<span class="st">'#b2182b'</span>,<span class="st">'#ef8a62'</span>,<span class="st">'#fddbc7'</span>,<span class="st">'#d1e5f0'</span>,<span class="st">'#67a9cf'</span>,<span class="st">'#2166ac'</span>]</span>
<span id="cb21-17"><a href="#cb21-17"></a>alt_color_scheme <span class="op">=</span> [<span class="st">'#762a83'</span>,<span class="st">'#af8dc3'</span>,<span class="st">'#e7d4e8'</span>,<span class="st">'#d9f0d3'</span>,<span class="st">'#7fbf7b'</span>,<span class="st">'#1b7837'</span>]</span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a>availability_levels_map <span class="op">=</span> {</span>
<span id="cb21-20"><a href="#cb21-20"></a>                        <span class="st">'Not at Liverpool'</span> : <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb21-21"><a href="#cb21-21"></a>                        <span class="st">'Injured'</span>:<span class="dv">0</span>, </span>
<span id="cb21-22"><a href="#cb21-22"></a>                        <span class="st">'Not in squad'</span>:<span class="dv">1</span>,</span>
<span id="cb21-23"><a href="#cb21-23"></a>                        <span class="st">'Bench'</span>:<span class="dv">2</span>, </span>
<span id="cb21-24"><a href="#cb21-24"></a>                        <span class="st">'Played (sub)'</span>:<span class="dv">3</span>,</span>
<span id="cb21-25"><a href="#cb21-25"></a>                        <span class="st">'Played (starter)'</span>:<span class="dv">4</span> </span>
<span id="cb21-26"><a href="#cb21-26"></a>                        }</span>
<span id="cb21-27"><a href="#cb21-27"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">10</span>), nrows<span class="op">=</span><span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, height_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">4</span>], constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-28"><a href="#cb21-28"></a></span>
<span id="cb21-29"><a href="#cb21-29"></a>bar_plot <span class="op">=</span> ax1.bar(cl_19_lineup_at_lpool_avail_df.index, cl_19_lineup_at_lpool_avail_df[<span class="st">"strangers_count"</span>], align<span class="op">=</span><span class="st">"edge"</span>)</span>
<span id="cb21-30"><a href="#cb21-30"></a></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co"># highlight champions lg final game</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="cf">for</span> i,bar <span class="kw">in</span> <span class="bu">enumerate</span>(bar_plot):</span>
<span id="cb21-33"><a href="#cb21-33"></a>    <span class="cf">if</span> cl_19_lineup_at_lpool_avail_df[<span class="st">"strangers_count"</span>][i] <span class="op">==</span><span class="dv">11</span>:</span>
<span id="cb21-34"><a href="#cb21-34"></a>        bar.set_color(<span class="st">"r"</span>)</span>
<span id="cb21-35"><a href="#cb21-35"></a></span>
<span id="cb21-36"><a href="#cb21-36"></a>ax1.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-37"><a href="#cb21-37"></a>ax1.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-38"><a href="#cb21-38"></a>ax1.spines[<span class="st">'bottom'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-39"><a href="#cb21-39"></a>ax1.spines[<span class="st">'left'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-40"><a href="#cb21-40"></a></span>
<span id="cb21-41"><a href="#cb21-41"></a><span class="co"># add horizontal line at 11 players</span></span>
<span id="cb21-42"><a href="#cb21-42"></a>ax1.axhline(y<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'r'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-43"><a href="#cb21-43"></a></span>
<span id="cb21-44"><a href="#cb21-44"></a>_ <span class="op">=</span> ax1.set_title(<span class="st">"When stars align: The 2019 CL Final Starting 11"</span>, fontdict<span class="op">=</span>{<span class="st">"fontsize"</span>:<span class="st">"25"</span>} )</span>
<span id="cb21-45"><a href="#cb21-45"></a>_ <span class="op">=</span> ax1.set_xlabel(<span class="st">""</span>)</span>
<span id="cb21-46"><a href="#cb21-46"></a>_ <span class="op">=</span> ax1.set_ylabel(<span class="st">"#players"</span>,rotation<span class="op">=</span><span class="st">"vertical"</span>, ha<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb21-47"><a href="#cb21-47"></a>_ <span class="op">=</span> ax1.yaxis.set_major_locator(matplotlib.ticker.FixedLocator([<span class="dv">11</span>]))</span>
<span id="cb21-48"><a href="#cb21-48"></a>_ <span class="op">=</span> ax1.tick_params(length<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-49"><a href="#cb21-49"></a></span>
<span id="cb21-50"><a href="#cb21-50"></a>num_levels <span class="op">=</span> <span class="bu">len</span>(availability_levels_map.keys())</span>
<span id="cb21-51"><a href="#cb21-51"></a>plot <span class="op">=</span> sns.heatmap(heatmap_data, ax<span class="op">=</span>ax2, cmap<span class="op">=</span>color_scheme,linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">'lightgray'</span>)</span>
<span id="cb21-52"><a href="#cb21-52"></a>colorbar <span class="op">=</span> plot.collections[<span class="dv">0</span>].colorbar</span>
<span id="cb21-53"><a href="#cb21-53"></a>total_bar_height <span class="op">=</span> colorbar.vmax <span class="op">-</span> colorbar.vmin </span>
<span id="cb21-54"><a href="#cb21-54"></a>lvl_bar_height <span class="op">=</span> total_bar_height<span class="op">/</span>num_levels</span>
<span id="cb21-55"><a href="#cb21-55"></a></span>
<span id="cb21-56"><a href="#cb21-56"></a></span>
<span id="cb21-57"><a href="#cb21-57"></a>colorbar.set_ticks([colorbar.vmin <span class="op">+</span> (lvl_bar_height <span class="op">*</span> (<span class="fl">0.5</span> <span class="op">+</span> i)) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_levels)])</span>
<span id="cb21-58"><a href="#cb21-58"></a>colorbar.set_ticklabels([<span class="op">*</span>availability_levels_map.keys()])</span>
<span id="cb21-59"><a href="#cb21-59"></a></span>
<span id="cb21-60"><a href="#cb21-60"></a>axs_fmtd <span class="op">=</span> [cl_19_lineup_at_lpool_avail_df.loc[<span class="bu">int</span>(i.get_text()), <span class="st">'date'</span>].strftime(<span class="st">"</span><span class="sc">%d</span><span class="st"> %b"</span>) <span class="cf">for</span> i <span class="kw">in</span> ax2.get_xticklabels()]</span>
<span id="cb21-61"><a href="#cb21-61"></a>_ <span class="op">=</span> ax2.set_xticklabels(axs_fmtd, rotation<span class="op">=</span><span class="st">"vertical"</span>, ha<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb21-62"><a href="#cb21-62"></a>_ <span class="op">=</span> ax2.set_xlabel(<span class="st">""</span>)</span>
<span id="cb21-63"><a href="#cb21-63"></a>_ <span class="op">=</span> ax2.tick_params(length<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-64"><a href="#cb21-64"></a>_ <span class="op">=</span> plt.gcf().text(<span class="fl">0.9</span>, <span class="dv">0</span>, <span class="st">"ismailmo.com"</span>, fontsize<span class="op">=</span><span class="dv">25</span>, fontdict<span class="op">=</span>{<span class="st">'color'</span>:  <span class="st">'blue'</span>} )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="final-visualisation" class="level1 page-columns page-full" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Final Visualisation</h1>
<p>The final visualisation is complete, but to add some extra context I added annotations using <a href="excalidraw.com">Excalidraw</a> to highlight some key points (probably could’ve done this in code but I got lazy):</p>
<div class="column-screen">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="annotated_heatmap_corrected.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Annotated heatmap</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="feedback" class="level1 page-columns page-full" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Feedback</h1>
<p>After posting <a href="https://old.reddit.com/r/LiverpoolFC/comments/yzpj66/the_mystery_behind_the_2019_ucl_final_starting_11/">this on reddit</a> there were some interesting suggestions for further analysis:</p>
<ul>
<li>How does this compare with the current season?</li>
</ul>
<div class="column-screen">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./comment-requests/season22-23.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">2022-23 season</figcaption><p></p>
</figure>
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><p>Any thoughts, comments or ideas? Please let me know <a href="mailto:ismailmo4@gmail.com">here</a>!</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ismailmo1">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/ismailmo-chem">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>